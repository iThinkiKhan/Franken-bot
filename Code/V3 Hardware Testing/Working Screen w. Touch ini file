[env:esp32s3]
platform = espressif32
board = esp32-s3-devkitc-1
framework = arduino

; --- Memory (N16R8: 16MB Flash, 8MB Octal PSRAM) ---
board_build.arduino.memory_type = qio_opi
board_build.psram = enabled

; --- Serial ---
monitor_speed = 115200
upload_speed = 921600

build_flags =
    -DBOARD_HAS_PSRAM
    -DARDUINO_USB_CDC_ON_BOOT=0
    -DARDUINO_USB_MODE=1
    ; ──────────────────────────────────
    ;  TFT_eSPI Configuration
    ; ──────────────────────────────────
    -DUSER_SETUP_LOADED
    -DILI9341_DRIVER
    -DTFT_WIDTH=240
    -DTFT_HEIGHT=320
    ; Display SPI pins (routed via GPIO matrix through SPI3)
    -DTFT_MOSI=11
    -DTFT_MISO=13
    -DTFT_SCLK=12
    -DTFT_CS=10
    -DTFT_DC=14
    -DTFT_RST=9
    ; Touch pins
    -DTOUCH_CS=47
    -DTOUCH_IRQ=21
    ; Use SPI3 (HSPI) — avoids FSPI bus conflict with Octal PSRAM on N16R8
    -DUSE_HSPI_PORT
    ; SPI speeds
    -DSPI_FREQUENCY=40000000
    -DSPI_READ_FREQUENCY=20000000
    -DSPI_TOUCH_FREQUENCY=2500000
    ; Critical for shared SPI bus with touch
    -DSUPPORT_TRANSACTIONS
    ; Font
    -DLOAD_GLCD=true

lib_deps =
    bodmer/TFT_eSPI
